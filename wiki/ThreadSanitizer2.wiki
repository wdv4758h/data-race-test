#summary Brand new ThreadSanitizer v2

ThreadSanitizer v2 is a complete redesign that aims to be considerably faster than the original implementation. It's in alpha stage, currently works only on Linux/amd64 with llvm compiler instrumentation.

=New detected types of bugs=
  * Use after free races: [http://code.google.com/p/data-race-test/source/browse/trunk/v2/output_tests/free_race.c output_tests/free_race.c]
  * Races on mutexes: [http://code.google.com/p/data-race-test/source/browse/trunk/v2/output_tests/race_on_mutex.c output_tests/race_on_mutex.c]
  * Races on pthread_barrier_t: [http://code.google.com/p/data-race-test/source/browse/trunk/v2/output_tests/race_on_barrier.c output_tests/race_on_barrier.c] [http://code.google.com/p/data-race-test/source/browse/trunk/v2/output_tests/race_on_barrier2.c output_tests/race_on_barrier2.c]
  * Leaked threads: [http://code.google.com/p/data-race-test/source/browse/trunk/v2/output_tests/thread_leak3.c output_tests/thread_leak3.c]

=Developing v2=
First of all, check out the repo and install dependencies:
{{{
svn checkout http://data-race-test.googlecode.com/svn/trunk/ tsan
cd tsan/v2
make install_deps
}}}
Then, you need a fresh clang compiler in your PATH. Refer to [http://llvm.org/ llvm.org].

To build the library and tests:
{{{
make
}}}
To run unit tests:
{{{
tests/tsan_test
}}}
To run output tests:
{{{
output_tests/test_output.sh
}}}
To run presubmit checks (lint, debug and release build, unit- and output tests):
{{{
make presubmit
}}}
To build release version of the library:
{{{
make DEBUG=0
}}}
To build with debug output:
{{{
make CFLAGS=-DTSAN_DEBUG_OUTPUT=1
}}}
To build with extended debug output (including memory accesses and function entry/exit events, be careful it can be enormous):
{{{
make CFLAGS=-DTSAN_DEBUG_OUTPUT=2
}}}
To build with stat collection (prints internal stats at exit):
{{{
make CFLAGS=-DTSAN_COLLECT_STATS=1
}}}
To build something real with v2:
{{{
clang test.c -fthread-sanitizer -fPIE -O1 -g -pie -lpthread -ldl -Lpath/to/libtsan -ltsan
}}}